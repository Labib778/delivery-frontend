<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1" />
<title>Simple Delivery App</title>
<style>
  /* Base */
  body {
    margin: 0;
    font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Oxygen,
      Ubuntu, Cantarell, "Open Sans", "Helvetica Neue", sans-serif;
    background: #fafafa;
    color: #222;
    -webkit-font-smoothing: antialiased;
    -moz-osx-font-smoothing: grayscale;
  }

  /* Navbar */
  .navbar {
    display: flex;
    justify-content: space-between;
    align-items: center;
    background: #f4b400;
    padding: 0.8rem 1.5rem;
    box-shadow: 0 3px 6px rgba(0,0,0,0.15);
    position: relative;
  }
  .logo-container {
    display: flex;
    align-items: center;
    gap: 8px;
  }
  .logo-img {
    max-height: 40px;
    width: auto;
  }
  .logo-text {
    font-weight: 700;
    font-size: 1.3rem;
    color: white;
    user-select: none;
    white-space: nowrap;
  }
  .menu-btn {
    background: none;
    border: none;
    cursor: pointer;
    font-size: 1.8rem;
    padding: 0.2rem;
    color: white;
  }
  .menu-content {
    position: absolute;
    right: 1.5rem;
    top: 3.8rem;
    background: white;
    border: 1px solid #ddd;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
    border-radius: 6px;
    width: 160px;
    display: none;
    flex-direction: column;
    z-index: 1000;
  }
  .menu-content.show {
    display: flex;
  }
  .menu-content button {
    background: none;
    border: none;
    padding: 1rem 1.2rem;
    cursor: pointer;
    font-size: 1.2rem;
    text-align: left;
    color: #333;
    transition: background 0.25s ease;
  }
  .menu-content button:hover {
    background: #f4b400;
    color: white;
  }

  /* Container */
  .container {
    max-width: 480px;
    margin: 1.5rem auto;
    padding: 0 1.2rem;
  }

  /* Hide sections by default */
  #dashboard-section, #orders-section, #login-section {
    display: none;
  }
  #register-section {
    display: block;
  }

  /* Inputs & Buttons */
  input, button, textarea {
    width: 100%;
    margin: 0.75rem 0;
    padding: 1.1rem;
    font-size: 1.3rem;
    border-radius: 8px;
    border: 1.5px solid #ccc;
    box-sizing: border-box;
  }
  button.primary {
    background: #f4b400;
    border: none;
    font-weight: 700;
    cursor: pointer;
    transition: background 0.3s ease;
  }
  button.primary:hover {
    background: #db9c00;
  }
  textarea {
    resize: vertical;
    min-height: 80px;
  }

  /* Message */
  .message {
    margin-bottom: 1rem;
    font-weight: 700;
    font-size: 1.2rem;
  }
  .message.error {
    color: #d9534f;
  }
  .message.success {
    color: #28a745;
  }

  /* Table */
  table {
    border-collapse: collapse;
    width: 100%;
    margin-top: 1.2rem;
  }
  th, td {
    border: 1px solid #ddd;
    padding: 1rem 0.8rem;
    font-size: 1.2rem;
  }
  th {
    background-color: #f4b400;
    color: #333;
  }
  tr:nth-child(even) {
    background: #f9f9f9;
  }
  button.cancel-btn {
    background: #d9534f;
    color: white;
    border: none;
    padding: 0.7rem 1.2rem;
    font-size: 1.1rem;
    border-radius: 6px;
    cursor: pointer;
    transition: background 0.25s ease;
  }
  button.cancel-btn:hover {
    background: #c9302c;
  }

  /* Links */
  a {
    color: #f4b400;
    font-weight: 600;
  }
  a:hover {
    text-decoration: underline;
  }

  /* Login method toggle */
  .login-method {
    margin: 1rem 0 0.5rem 0;
    font-weight: 600;
    display: flex;
    gap: 1.5rem;
    align-items: center;
  }
  .login-method label {
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.3rem;
    font-size: 1.15rem;
  }
  .login-method input[type="radio"] {
    width: 18px;
    height: 18px;
    margin: 0;
  }
</style>
</head>
<body>

<div class="navbar">
  <div class="logo-container">
    <img class="logo-img" src="https://i.imgur.com/qWf6B6X.png" alt="Taqwa Logo" />
    <div class="logo-text">Taqwa Home Delivery</div>
  </div>
  <button class="menu-btn" aria-label="Menu" onclick="toggleMenu()">â˜°</button>
  <div id="menu-content" class="menu-content" role="menu">
    <button onclick="showDashboardSection()">Place Order</button>
    <button onclick="showOrdersSection()">View Orders</button>
    <button onclick="logout()">Logout</button>
  </div>
</div>

<div class="container">

  <div id="message" class="message"></div>

  <!-- Register -->
  <div id="register-section">
    <h2>Register</h2>
    <input type="text" id="reg-name" placeholder="Name" autocomplete="name" />
    <input type="email" id="reg-email" placeholder="Email" autocomplete="email" />
    <input type="tel" id="reg-phone" placeholder="Phone Number" autocomplete="tel" />
    <input type="password" id="reg-password" placeholder="Password" autocomplete="new-password" />
    <button class="primary" onclick="register()">Register</button>
    <p>Already registered? <a href="#" onclick="showLoginSection()">Login here</a></p>
  </div>

  <!-- Login -->
  <div id="login-section">
    <h2>Login</h2>
    <div class="login-method">
      <label><input type="radio" name="login-method" value="email" checked onchange="toggleLoginInput()"> Email</label>
      <label><input type="radio" name="login-method" value="phone" onchange="toggleLoginInput()"> Phone</label>
    </div>
    <input type="email" id="login-email" placeholder="Email" autocomplete="email" />
    <input type="tel" id="login-phone" placeholder="Phone Number" autocomplete="tel" style="display:none;" />
    <input type="password" id="login-password" placeholder="Password" autocomplete="current-password" />
    <button class="primary" onclick="login()">Login</button>
    <p>No account? <a href="#" onclick="showRegisterSection()">Register here</a></p>
  </div>

  <!-- Dashboard - Place Order -->
  <div id="dashboard-section">
    <h2>Hi, <span id="user-name"></span>!</h2>

    <h3>Place Order</h3>
    <input type="text" id="order-product" placeholder="Product" autocomplete="off" />
    <input type="text" id="order-qty" placeholder="Quantity (Kg, Pcs, ml)" autocomplete="off" />
    <textarea id="order-address" placeholder="Delivery Address" autocomplete="off"></textarea>
    <input type="tel" id="order-phone" placeholder="Phone Number" autocomplete="tel" />
    <textarea id="order-message" placeholder="Optional message (e.g. delivery instructions)" rows="3"></textarea>
    <button class="primary" onclick="placeOrder()">Place Order</button>
  </div>

  <!-- Orders Section -->
  <div id="orders-section">
    <h2>Your Orders</h2>
    <table>
      <thead><tr><th>Product</th><th>Qty</th><th>Status</th><th>Cancel</th></tr></thead>
      <tbody id="orders-list"></tbody>
    </table>
  </div>

</div>

<script>
  const BACKEND_URL = "https://delivery-backend-jd78.onrender.com";

  const messageDiv = document.getElementById("message");
  const menuContent = document.getElementById("menu-content");

  function showMessage(msg, type="") {
    messageDiv.textContent = msg;
    messageDiv.className = "message " + type;
    if(msg) setTimeout(() => {
      messageDiv.textContent = "";
      messageDiv.className = "message";
    }, 4000);
  }

  // Toggle menu visibility
  function toggleMenu() {
    menuContent.classList.toggle("show");
  }
  // Close menu on outside click
  window.onclick = function(event) {
    if (!event.target.matches('.menu-btn')) {
      if(menuContent.classList.contains("show")) {
        menuContent.classList.remove("show");
      }
    }
  }

  // Show/hide sections helpers
  function hideAllSections() {
    document.getElementById("register-section").style.display = "none";
    document.getElementById("login-section").style.display = "none";
    document.getElementById("dashboard-section").style.display = "none";
    document.getElementById("orders-section").style.display = "none";
  }
  function showRegisterSection() {
    hideAllSections();
    document.getElementById("register-section").style.display = "block";
  }
  function showLoginSection() {
    hideAllSections();
    document.getElementById("login-section").style.display = "block";
  }
  function showDashboardSection() {
    hideAllSections();
    document.getElementById("dashboard-section").style.display = "block";
    clearOrderForm();
  }
  async function showOrdersSection() {
    hideAllSections();
    document.getElementById("orders-section").style.display = "block";
    await loadOrders();
  }

  // Toggle login input fields (email/phone)
  function toggleLoginInput() {
    const method = document.querySelector('input[name="login-method"]:checked').value;
    if(method === "email") {
      document.getElementById("login-email").style.display = "block";
      document.getElementById("login-phone").style.display = "none";
    } else {
      document.getElementById("login-email").style.display = "none";
      document.getElementById("login-phone").style.display = "block";
    }
  }

  // Register
  async function register() {
    const name = document.getElementById('reg-name').value.trim();
    const email = document.getElementById('reg-email').value.trim();
    const phone = document.getElementById('reg-phone').value.trim();
    const password = document.getElementById('reg-password').value;
    if (!name || !email || !phone || !password) return showMessage("Please fill all fields", "error");

    try {
      const res = await fetch(BACKEND_URL + "/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({ name, email, phone, password })
      });
      const data = await res.json();
      if(data.error) return showMessage(data.error, "error");
      showMessage("Registered successfully!", "success");
      showLoginSection();
    } catch(e) {
      showMessage("Network error", "error");
    }
  }

  // Login
  async function login() {
    const method = document.querySelector('input[name="login-method"]:checked').value;
    let loginData = {};
    if(method === "email") {
      const email = document.getElementById('login-email').value.trim();
      if(!email) return showMessage("Please enter your email", "error");
      loginData.email = email;
    } else {
      const phone = document.getElementById('login-phone').value.trim();
      if(!phone) return showMessage("Please enter your phone number", "error");
      loginData.phone = phone;
    }
    const password = document.getElementById('login-password').value;
    if (!password) return showMessage("Please enter your password", "error");

    try {
      const res = await fetch(BACKEND_URL + "/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({...loginData, password})
      });
      const data = await res.json();
      if(data.error) return showMessage(data.error, "error");

      sessionStorage.setItem("token", data.token);
      sessionStorage.setItem("name", data.name);
      document.getElementById("user-name").textContent = data.name;
      showDashboardSection();
    } catch(e) {
      showMessage("Network error", "error");
    }
  }

  // Logout
  function logout() {
    sessionStorage.clear();
    hideAllSections();
    showLoginSection();
  }

  // Place order
  async function placeOrder() {
    const product = document.getElementById('order-product').value.trim();
    const qty = document.getElementById('order-qty').value.trim();
    const address = document.getElementById('order-address').value.trim();
    const phone = document.getElementById('order-phone').value.trim();
    const message = document.getElementById('order-message').value.trim();
    if (!product || !qty || !address || !phone) return showMessage("Please fill all required fields", "error");

    const token = sessionStorage.getItem("token");
    if (!token) return logout();

    try {
      const res = await fetch(BACKEND_URL + "/order", {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ product, qty, address, phone, message })
      });
      const data = await res.json();
      if(data.error) return showMessage(data.error, "error");
      showMessage("Order placed successfully!", "success");
      clearOrderForm();
      loadOrders();
    } catch(e) {
      showMessage("Network error", "error");
    }
  }
  function clearOrderForm() {
    document.getElementById('order-product').value = '';
    document.getElementById('order-qty').value = '';
    document.getElementById('order-address').value = '';
    document.getElementById('order-phone').value = '';
    document.getElementById('order-message').value = '';
  }

  // Load orders
  async function loadOrders() {
    const token = sessionStorage.getItem("token");
    if (!token) return logout();

    try {
      const res = await fetch(BACKEND_URL + "/orders", {
        headers: { "Authorization": "Bearer " + token }
      });
      const data = await res.json();
      if(data.error) {
        showMessage(data.error, "error");
        return;
      }
      const tbody = document.getElementById("orders-list");
      tbody.innerHTML = "";
      if(data.orders.length === 0) {
        tbody.innerHTML = "<tr><td colspan='4'>No orders found</td></tr>";
        return;
      }
      data.orders.forEach(order => {
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${order.product}</td>
          <td>${order.qty}</td>
          <td>${order.status}</td>
          <td>${order.status !== "Cancelled" ? `<button class="cancel-btn" onclick="cancelOrder('${order._id}')">Cancel</button>` : ''}</td>
        `;
        tbody.appendChild(tr);
      });
    } catch(e) {
      showMessage("Network error", "error");
    }
  }

  // Cancel order
  async function cancelOrder(orderId) {
    if(!confirm("Cancel this order?")) return;
    const token = sessionStorage.getItem("token");
    try {
      const res = await fetch(BACKEND_URL + "/order/cancel", {
        method: "POST",
        headers: { 
          "Content-Type": "application/json",
          "Authorization": "Bearer " + token
        },
        body: JSON.stringify({ orderId })
      });
      const data = await res.json();
      if(data.error) return showMessage(data.error, "error");
      showMessage(data.message, "success");
      loadOrders();
    } catch(e) {
      showMessage("Network error", "error");
    }
  }

  // On load: show login or dashboard
  (function(){
    const token = sessionStorage.getItem("token");
    const name = sessionStorage.getItem("name");
    if(token && name) {
      document.getElementById("user-name").textContent = name;
      showDashboardSection();
    } else {
      showRegisterSection();
    }
  })();
</script>

</body>
</html>
